<!DOCTYPE html>
<html lang="zh-HK">
<head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Secure Ziwei</title></head>
<body>
  <h2>登入</h2>
  <input id="pwd" type="password" placeholder="Password"/>
  <button id="loginBtn">登入</button>
  <pre id="msg"></pre>

  <h2>轉換</h2>
  <textarea id="input" rows="8" cols="80" placeholder="貼上命盤文本..."></textarea><br/>
  <button id="convertBtn">呼叫 /api/convert</button>
  <h3>結果</h3>
  <div id="table"></div>
  <pre id="prompt"></pre>

<script>
let TOKEN = null;
loginBtn.onclick = async () => {
  const r = await fetch('/api/login', { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ password: pwd.value }) });
  const j = await r.json();
  if (!r.ok) { msg.textContent = '登入失敗：' + (j.error||r.status); return; }
  TOKEN = j.token;
  msg.textContent = '登入成功';
};

convertBtn.onclick = async () => {
  const r = await fetch('/api/convert', { method:'POST', headers:{'Content-Type':'application/json','Authorization':'Bearer '+TOKEN}, body: JSON.stringify({ rawText: input.value }) });
  const j = await r.json();
  if (!r.ok) { alert('錯誤：' + JSON.stringify(j)); return; }
  table.innerHTML = j.tableHtml;
  prompt.textContent = j.prompt;
};
</script>
</body></html>
